from z3 import *

mask =  [65.0, 65.0, 65.0, 65.0, 65.0, 65.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 65.0]
Y = [30119.802734375, 13779.0263671875, -12472.4462890625, 5415.44580078125, -31216.16796875, -28912.287109375, 956.1978759765625, 15010.453125, 7361.8486328125, -1424.9993896484375, 13769.30078125, -4631.6044921875, 6077.791015625, 32217.505859375, -7041.21044921875, -14829.01953125, -20104.30859375]  # Vettore di dimensione 17
a = [2297.7744140625, -2861.31640625, -7645.728515625, -6779.5966796875, -202.0673828125, -18601.2109375, 5505.0439453125, 17107.994140625, 14200.76953125, 3903.301025390625, 9999.9951171875, -4237.02392578125, 1316.4927978515625, 6421.00146484375, 2606.84912109375, -4413.908203125, -11088.5908203125]  # Vettore di dimensione 17
M = [[14.083111763000488, -21.093128204345703, 27.5848445892334, 85.38813781738281, 108.63888549804688, -67.75312042236328, -37.28829574584961, 10.737760543823242, 88.74873352050781, 56.26428985595703, -43.29020690917969, -10.811084747314453, 24.698925018310547, 63.205528259277344, 33.133033752441406, 24.527023315429688, 73.76756286621094, -8.647464752197266, -20.59228515625, -35.64673614501953, 42.334835052490234, 27.572107315063477, 132.8322296142578, -112.06133270263672], [-16.09868812561035, 19.057777404785156, -17.164052963256836, -52.811405181884766, 28.660751342773438, 29.88193702697754, -21.278949737548828, 6.140632629394531, 4.24423360824585, 63.46339797973633, 41.767051696777344, 33.8902587890625, 44.8789176940918, -3.274832010269165, -45.79128646850586, 60.413230895996094, 32.70670700073242, -40.73398971557617, 11.45885944366455, 0.042406827211380005, 5.431713104248047, 95.30315399169922, -36.53506851196289, -34.6730842590332], [13.520511627197266, 14.587614059448242, -42.93982696533203, -81.8447265625, 13.502045631408691, -31.12798500061035, 18.355243682861328, 60.556148529052734, 23.651580810546875, -37.591800689697266, -86.31752014160156, -5.696809768676758, -49.220985412597656, -24.431795120239258, -17.783761978149414, 42.25759506225586, 55.676204681396484, -2.682206630706787, -38.546165466308594, 46.474239349365234, 20.05677604675293, 12.404017448425293, -90.2928237915039, -2.776219367980957], [10.66776180267334, 24.598230361938477, -160.80685424804688, -4.363319396972656, 28.86918830871582, -7.434226036071777, -25.222850799560547, -42.49892044067383, -40.960113525390625, 75.62287902832031, 73.50810241699219, 34.90530776977539, -0.004345628898590803, -24.016263961791992, 22.076107025146484, 14.517596244812012, -16.691810607910156, 18.311382293701172, 72.21385192871094, 4.912503719329834, 77.78411865234375, -47.6834602355957, -12.000679016113281, 3.0287084579467773], [-74.07192993164062, -8.909040451049805, 52.352622985839844, 41.13099670410156, -19.242938995361328, 14.09388542175293, 49.9478759765625, -111.48120880126953, -29.765165328979492, -0.9207760095596313, -33.96016311645508, -60.89194869995117, 15.394901275634766, 16.514677047729492, -3.806154251098633, -83.82622528076172, -147.57525634765625, 29.520231246948242, -69.70668029785156, -41.78556442260742, -27.47294044494629, 20.920574188232422, 8.98318099975586, -8.963908195495605], [-47.53983688354492, 9.509182929992676, -51.18824005126953, -91.79300689697266, 21.672527313232422, -16.890451431274414, -83.6245346069336, -32.9526481628418, 27.25017738342285, -32.442230224609375, 32.60881042480469, 20.95785140991211, -19.405162811279297, -42.69183349609375, 27.704103469848633, 21.624555587768555, 12.632318496704102, 3.6604862213134766, -84.55728912353516, 62.963619232177734, -18.475017547607422, -23.0056209564209, -28.476116180419922, -110.51953887939453], [4.874713897705078, -0.5786820650100708, 97.13846588134766, 3.0713860988616943, -27.40007781982422, 4.323321342468262, -103.36582946777344, 63.682437896728516, -50.230098724365234, -13.976278305053711, 51.3693733215332, -21.513938903808594, -32.15132141113281, 43.08685302734375, -6.146883964538574, -8.2421875, 16.595468521118164, -41.9631462097168, 25.937503814697266, -17.9923095703125, 12.862617492675781, -8.215730667114258, 21.341609954833984, 3.6725025177001953], [-43.386253356933594, 65.8663101196289, 33.282676696777344, 183.4001007080078, 11.135612487792969, -14.210341453552246, 1.6208752393722534, 24.354442596435547, 50.25114822387695, 68.37651062011719, -12.886887550354004, 4.5841240882873535, 18.711265563964844, -15.077702522277832, -92.5900650024414, -48.95946502685547, -58.656646728515625, 3.4783592224121094, 8.965039253234863, 7.610334396362305, 47.226810455322266, 9.398346900939941, -48.1873664855957, 27.857202529907227], [15.808822631835938, 18.33510398864746, 56.10253143310547, 27.224470138549805, -12.023898124694824, 29.20049476623535, -7.039530277252197, -54.04595184326172, -49.00905227661133, 2.228874683380127, 31.768421173095703, 4.047187805175781, 18.594568252563477, 36.968990325927734, -1.2151257991790771, -70.23845672607422, -53.45893859863281, -21.469886779785156, 50.49736022949219, -14.95691967010498, 3.9475173950195312, 96.0422592163086, -76.28138732910156, 83.5088882446289], [-16.448163986206055, -0.5822932720184326, 109.09708404541016, -17.98921775817871, -41.99872970581055, 56.49946212768555, 22.9201717376709, 4.223255157470703, -46.25325012207031, 0.8309689164161682, 23.399742126464844, -60.17200469970703, 48.7631721496582, -4.77979040145874, 5.81589937210083, -48.00364685058594, 65.579833984375, -36.552101135253906, 7.627442836761475, -4.74073600769043, -35.923004150390625, -19.672069549560547, -3.7957358360290527, -27.987346649169922], [50.8541374206543, -19.96805191040039, -3.5719289779663086, 35.404422760009766, 57.4595947265625, 109.772216796875, 98.59402465820312, 3.992859363555908, 57.646549224853516, 59.089866638183594, -90.64559173583984, -56.82862854003906, 20.660158157348633, 17.6534366607666, -88.25901794433594, -6.006994247436523, 79.58600616455078, -45.743709564208984, -54.75072479248047, -15.608312606811523, 13.360225677490234, 32.195369720458984, 32.17522430419922, -76.42002868652344], [46.884483337402344, -18.505550384521484, 64.97880554199219, -84.50189208984375, -22.48431968688965, 37.44792556762695, -37.19039535522461, -15.293030738830566, -38.388214111328125, 45.00971603393555, -32.63212966918945, 34.736656188964844, -65.66336059570312, -64.83155059814453, 90.5516586303711, -5.330600261688232, -24.765268325805664, 33.29338073730469, 79.56572723388672, 19.98636817932129, 56.54978942871094, -6.974363327026367, -74.60274505615234, -89.25984191894531], [-24.66455841064453, -34.73575210571289, 72.79914093017578, -52.439735412597656, 6.4247894287109375, 86.24896240234375, -10.325460433959961, 58.4490966796875, -33.03460693359375, -2.889193058013916, -34.45145034790039, -39.07297897338867, -24.850627899169922, 28.72644805908203, 34.408546447753906, -44.49432373046875, 16.30364990234375, 54.56824493408203, -66.06526184082031, 32.777305603027344, -11.189815521240234, 15.04130744934082, 98.23999786376953, -33.901512145996094], [65.45313262939453, -17.759262084960938, -46.99637222290039, 120.32220458984375, -31.3924560546875, 0.5596599578857422, -64.19953918457031, 29.327072143554688, 63.53266525268555, -23.222946166992188, -9.851374626159668, 3.1637048721313477, 90.05046081542969, 31.756223678588867, 33.919776916503906, -52.5133056640625, -5.041065216064453, -13.864517211914062, 67.66911315917969, 42.80028533935547, 103.94255828857422, 10.753259658813477, 82.6338119506836, 8.442731857299805], [41.833309173583984, -18.100017547607422, -80.50690460205078, -24.934152603149414, 83.33555603027344, 13.954256057739258, 22.072002410888672, -29.740625381469727, 10.039894104003906, -77.95263671875, 90.65242004394531, 7.964435577392578, 58.18193054199219, -45.107948303222656, -29.33697509765625, -19.733821868896484, 20.53451919555664, -52.80314636230469, -95.89601135253906, 26.378280639648438, -56.32710647583008, 33.891807556152344, -8.999794960021973, 24.687320709228516], [21.97354507446289, -20.02977180480957, 9.031652450561523, -1.3756122589111328, -38.22325134277344, 15.730119705200195, 29.7758846282959, -5.814387321472168, -15.411724090576172, -19.996246337890625, -22.128570556640625, -53.1872444152832, -46.678436279296875, -51.05035400390625, 19.756593704223633, 2.594066619873047, 17.898025512695312, 15.121233940124512, 40.04393005371094, 52.54083251953125, 11.46518611907959, -110.40959930419922, -22.32390594482422, -54.12230682373047], [-26.108078002929688, -45.338382720947266, -71.59312438964844, 49.01884078979492, 18.9771671295166, -41.80302429199219, 43.70650100708008, -7.158376216888428, 54.89641571044922, 19.192455291748047, 84.69557189941406, 21.699748992919922, 29.04989242553711, -45.075294494628906, -31.264629364013672, -78.68064880371094, -69.8828353881836, -122.2593994140625, 20.479537963867188, -9.633321762084961, -17.86882781982422, 31.073122024536133, -59.57156753540039, -54.72321701049805]]  # Matrice di dimensione 24x17


Y = [38883.9140625, 18747.87890625, -15371.05078125, 12231.2080078125, -56379.48046875, -33719.13671875, 9454.150390625, 9346.9814453125, 1701.4693603515625, -6380.3759765625, 12019.501953125, -4850.94140625, 14421.296875, 44332.0390625, -11196.283203125, -19712.0859375, -36390.265625]
a = [-7453.044921875, -2458.87939453125, -8463.708984375, -8686.4287109375, -1509.0908203125, -26070.3125, 7064.54443359375, 14994.4921875, 21467.55859375, 6481.65234375, 12949.71875, -4577.3916015625, 5774.14306640625, 5067.12939453125, 6097.44580078125, -6787.32666015625, -18956.83984375]
mask = [84, 67, 80, 49, 80, 123, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 125] 


b = [Real(f'b{i}') for i in range(24)]

solver = Solver()

epsilon = 1e-2
for i in range(6):
    solver.add(And(b[i] <= epsilon, b[i] >= -epsilon))
solver.add(And(b[23] <= epsilon, b[23] >= -epsilon))

for i in range(6, 23):
    solver.add(And(b[i] >= 0, b[i] <= 256))

for i in range(17):
    equation = Y[i] == sum(M[i][j] * b[j] for j in range(24)) + a[i]
    solver.add(equation)

if solver.check() == sat:
    model = solver.model()
    solution = [ model[b[i]].as_decimal(6) for i in range(24)]  # Precisione limitata
    print(solution)
    for i in range(24):
        if '?' in solution[i]:
            solution[i] = solution[i].replace('?', '')
    solution = [round(float(solution[i])) for i in range(24)]
    solution = [ solution[i] + mask[i] for i in range(24)]
    sol = ''.join([chr(int(solution[i])) for i in range(24)])
    print("Soluzione trovata per b:", sol)
    #solution = [model[b[i]] for i in range(24)]
    #print("Soluzione trovata per b:", solution)
else:
    print("Nessuna soluzione trovata")