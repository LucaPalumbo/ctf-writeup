import torch, random
import torch.nn
import numpy as np

#a = "AAAAAA"+"\x00"*17+"A"

a = []
a.append( np.array( [65.0, 65.0, 65.0, 65.0, 65.0, 65.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 65.0] ))
a.append( np.array([-5.480006217956543, -61.86000061035156, -143.3199920654297, 72.88999938964844, -12.749998092651367, 54.09000015258789, 171.27999877929688, 83.04998779296875, 118.62999725341797, 228.42999267578125, -86.38001251220703, 22.940000534057617, -162.16000366210938, -71.68000030517578, 185.29000854492188, -26.32000160217285, -92.91999053955078, -46.59000778198242, -123.60000610351562, 36.75, 86.34000396728516, 72.81001281738281, 140.1699981689453, 76.21000671386719, -6.129998683929443, 44.61000061035156, -47.71999740600586, 138.79000854492188, -121.73999786376953, 218.33999633789062, 95.55999755859375, 82.8699951171875, 6.749998569488525, -52.59999465942383, -192.30999755859375, 127.00000762939453, -16.050003051757812, 88.8800048828125, -45.40999984741211, -8.249998092651367, -15.169999122619629, 4.530001640319824, 50.91999816894531, 48.01000213623047, 31.90999984741211, 156.77999877929688, 84.37001037597656, -70.30999755859375, 6.510000228881836, -70.8499984741211, 11.650004386901855, -92.04000091552734, -35.98999786376953, -147.98001098632812, -91.2699966430664, 68.47999572753906, -24.549999237060547, 37.37999725341797, 23.20999526977539, -148.39999389648438, 42.31999969482422, -52.77000427246094, 29.249998092651367, -133.5, 183.72000122070312, 17.12000274658203, 138.6999969482422, -50.64999771118164, -185.6599884033203, 56.93000030517578, 59.20000457763672, -33.4900016784668, -121.86000061035156, 30.419998168945312, 108.08000183105469, -39.41999816894531, 69.56999969482422, -157.1899871826172, 18.910003662109375, 45.6400032043457, -53.64999771118164, 64.55999755859375, -124.73999786376953, -58.7599983215332, -122.24000549316406, -90.03998565673828, -23.659996032714844, 162.1300048828125, -17.209999084472656, -64.94000244140625, -52.63999938964844, 57.6099967956543, -104.9800033569336, -36.80000305175781, 2.650006055831909, 47.439998626708984, -26.57000732421875, -25.18000030517578, 36.28999328613281, -105.68000793457031, -57.14999771118164, 35.15999984741211, 172.22000122070312, 29.91999626159668, -223.87001037597656, -110.59999084472656, -48.619998931884766, 88.75, -39.200008392333984, 55.22999954223633, -111.0199966430664, -227.7100067138672, 86.34000396728516, 25.73000144958496, -211.13999938964844, 119.05000305175781, -67.61998748779297, 37.579994201660156, 112.76000213623047, 161.38999938964844, -136.04000854492188, 94.0, -67.16000366210938, 23.389999389648438, 52.600006103515625, 62.209999084472656, -19.569997787475586, 135.6800079345703, 75.12999725341797, 6.19000244140625, 5.4099931716918945, 68.26000213623047, 165.32000732421875, 168.44000244140625, 90.97999572753906, 150.02999877929688, -24.350000381469727, 44.83000183105469, -83.08000946044922, 15.400004386901855, 104.97999572753906, -11.590003967285156, 27.60000228881836, 183.52999877929688, 185.09999084472656, -67.82001495361328, 5.759998321533203, 66.2300033569336, 66.40999603271484, 83.72999572753906, -59.529998779296875, -71.239990234375, -108.40999603271484, -22.010000228881836, 60.160003662109375, -124.49000549316406, -133.6099853515625, 181.9600067138672, 170.11001586914062, 119.64999389648438, 34.09000778198242, -11.479994773864746, 94.62000274658203, -47.82000732421875, 16.280004501342773, 151.02000427246094, -99.1500015258789, 172.19000244140625, 65.29000091552734, 11.079998016357422, -109.45000457763672, 170.66001892089844, 4.500001430511475, -48.93000030517578, -162.3800048828125, 151.27999877929688, -132.35000610351562, 131.97000122070312, -250.260009765625, 12.260002136230469, 117.68000030517578, -133.1300048828125, 61.75000762939453, -21.059993743896484, -52.20000457763672, 77.62000274658203, -138.25999450683594, 112.4000015258789, -19.329999923706055, 61.279998779296875, 146.37998962402344, -106.39000701904297, 108.7699966430664, 227.38999938964844, -21.490001678466797, 150.90000915527344, -129.0699920654297, 54.97999572753906, -79.68998718261719, 115.51000213623047, 20.209999084472656, 4.229992866516113, -20.49000358581543, -87.95999145507812, 142.6999969482422, 8.199996948242188, 23.07000160217285, 55.51000213623047, 30.04999542236328, 15.580001831054688, 58.78000259399414, 27.139995574951172, 115.70000457763672, -18.5, -33.399993896484375, -41.310001373291016, -56.670005798339844, -105.56001281738281, 68.97000122070312, -32.18000411987305, -87.95000457763672, -94.66000366210938, -62.07999801635742, 71.09000396728516, -68.08000183105469, -89.81999969482422, -110.8499984741211, -15.649995803833008, 40.63999938964844, -0.5799999833106995, -82.6399917602539, 132.22999572753906, -149.85000610351562, -128.37001037597656, 148.5, 146.79000854492188, 159.33999633789062, -129.5399932861328, 71.66999816894531, -68.55998992919922, 20.19999885559082, -133.2899932861328, 138.25, -205.88999938964844, -18.190000534057617, 44.0099983215332, -115.66999816894531, -30.4899959564209, 52.27000427246094, 249.010009765625, 33.70999526977539, 129.69000244140625, 28.15000343322754, 51.19000244140625, 65.72000122070312, -18.26999855041504, 52.040000915527344, -95.1300048828125, 156.97999572753906, -21.09999656677246, 70.2800064086914, 120.42998504638672, 55.280006408691406, 124.22999572753906, 18.110008239746094, -7.8000030517578125, 59.980003356933594, -99.90999603271484, -6.279999732971191, -90.25000762939453, 36.06999588012695, 23.239994049072266, 86.86000061035156, -8.779998779296875, 41.839996337890625, 49.94999694824219, 40.64999771118164, -98.02000427246094, -123.62998962402344, -55.21000671386719, 94.52999114990234, -73.89999389648438, -110.49000549316406, 31.460006713867188, 23.500001907348633, -11.640003204345703, 67.31999969482422, -69.68999481201172, 4.400005340576172, 9.950007438659668, -42.350006103515625, 165.1199951171875, -19.230005264282227, -81.39000701904297, -13.339998245239258, 104.65999603271484, 18.689998626708984, -89.16000366210938, -107.18999481201172, -52.959999084472656, -9.180000305175781, 69.31999969482422, -148.11000061035156, 199.82000732421875, 26.259990692138672, -231.14999389648438, 121.14998626708984, -21.520000457763672, 63.059993743896484, -63.30999755859375, 58.71999740600586, -20.830001831054688, -40.540000915527344, 232.29998779296875, 78.78999328613281, -102.5199966430664, -100.01000213623047, 108.65999603271484, -42.5, 201.97000122070312, -5.060003280639648, -107.3899917602539, 74.16999816894531, 30.700000762939453, -14.100004196166992, 40.53000259399414, -21.97000503540039, -195.24000549316406, 65.62000274658203, -42.25, 61.67000198364258, -88.90000915527344, -98.41000366210938, -201.11000061035156, -44.44999313354492, -5.069997787475586, 4.940000534057617, -1.2600045204162598, -3.9200029373168945, 8.00000286102295, 100.87999725341797, -54.439998626708984, 89.83999633789062, 26.489986419677734, 205.0600128173828, 129.29000854492188, -50.98999786376953, 104.22001647949219, 30.149999618530273, -70.48999786376953, 73.19999694824219, -31.959999084472656, 192.51998901367188, 28.59000015258789, 3.2300000190734863, -11.279994010925293, -68.75, -59.52999496459961, 69.61000061035156, 44.70000457763672, 37.71999740600586, 75.95999145507812, 129.22999572753906, 135.52999877929688, 14.370000839233398, -33.349998474121094, -182.95999145507812, 25.770004272460938, 151.38999938964844, 15.630003929138184, 100.2300033569336, 33.889991760253906, -13.840002059936523, 65.75, 31.770008087158203, -14.120002746582031, -170.9499969482422, -74.76001739501953, -4.609999179840088, 54.94999694824219, 94.30000305175781, 49.7700080871582, -148.260009765625, -252.58999633789062, 6.670003414154053, -14.639997482299805, 90.9800033569336, 49.650001525878906, 47.18000793457031, -10.050000190734863, -62.11000061035156, 63.68999481201172, -86.76000213623047, 14.480000495910645, 7.889997482299805, 22.52000617980957, 64.91999816894531, 14.010001182556152, 81.09000396728516, 194.1300048828125, 8.0700044631958, -94.1500015258789, -40.619998931884766, -125.94999694824219, 158.27999877929688, 23.820009231567383, -58.43999481201172, -80.81000518798828, 38.37998962402344, 17.049999237060547, 41.23999786376953, 97.25, 108.56000518798828, 69.6300048828125, -68.64000701904297, 106.989990234375, 111.90999603271484, -18.239999771118164, 4.940004348754883, 63.400001525878906, -215.7100067138672, -187.8900146484375, -46.099998474121094, 81.75, 37.720001220703125, -5.3499956130981445, 47.910003662109375, -85.92000579833984, -47.489994049072266, 83.54999542236328, -13.670005798339844, -92.87000274658203, -11.149998664855957, 84.69000244140625, 19.409997940063477, 58.7400016784668, -62.08999252319336, -164.16000366210938, 22.779996871948242, -81.08000183105469, -96.25000762939453, 78.87999725341797, -144.08999633789062, 102.12999725341797, -54.599998474121094, 153.72000122070312, 69.47000122070312, -71.43000793457031, 18.909996032714844, 24.580007553100586]))
a.append( np.array([422.6108703613281, 1171.415771484375, -544.9596557617188, 25.725265502929688, -6.998091697692871, 797.1629028320312, -720.9866333007812, 96.24028778076172, 57.40406799316406, 318.29736328125, 368.05804443359375, -371.94580078125, 1149.02197265625, -1063.451171875, 1083.823486328125, -1515.0577392578125, -395.53900146484375, -1158.357421875, -1772.54541015625, -695.773681640625, 2895.15576171875, 595.7296142578125, 414.22735595703125, -2992.867431640625, 1779.5450439453125, -394.4730529785156, -913.0178833007812, 1094.4256591796875, 1512.818115234375, 965.468017578125, 158.67666625976562, 801.0186157226562, 2536.55078125, -163.35833740234375, -413.5439453125, 1365.38037109375, -1441.27587890625, 614.7913818359375, 227.3148193359375, 1992.977294921875, 90.92789459228516, 1552.6632080078125, 1307.893310546875, 1727.3460693359375, -522.771728515625, -44.4401969909668, 2096.865966796875, -1021.8948974609375, 787.3040161132812, -956.43212890625, 571.84619140625, 1195.322998046875, 2784.602294921875, -1043.4273681640625, -2037.16455078125, 1058.7069091796875, -1700.593505859375, -978.9383544921875, -1010.756103515625, -930.9324951171875, 138.48776245117188, 201.11651611328125, -227.88600158691406, -988.9575805664062, 1906.446044921875, 1211.573486328125, -802.0427856445312, 1386.2025146484375, -1236.37841796875, -1923.3427734375, 518.00244140625, -1181.9376220703125, -1814.3988037109375, -44.847900390625, -1190.9456787109375, 1549.4715576171875, -83.74929809570312, 811.09375, -65.75680541992188, 444.0700378417969, 1015.0919189453125, -135.8401336669922, -1314.4244384765625, 891.4277954101562, -1257.9493408203125, 1268.2130126953125, -117.3840103149414, -772.602294921875, -1383.2879638671875, 1650.2076416015625, -3027.49365234375, 127.44336700439453, 624.1469116210938, -2103.832763671875, 427.97119140625, 422.2965393066406, -311.8901062011719, 1233.083740234375, 1318.9752197265625, -21.473142623901367, -309.3554992675781, -20.336973190307617, 469.1771545410156, -1970.8460693359375, 1527.9959716796875, -831.5011596679688, -238.3242645263672, -795.7848510742188, -2478.8037109375, 892.3876953125, -192.95802307128906, -1048.5220947265625, 1122.576416015625, -1004.844482421875, -1991.601318359375, 628.8032836914062, -955.4509887695312, 1045.5498046875, 841.9212036132812, -619.2886962890625, 510.9176025390625, 475.20257568359375, -371.2391357421875, 724.0833129882812, 469.5079040527344, 500.013671875, 2308.9951171875, 1144.1199951171875]))
a.append( np.array([2297.7744140625, -2861.31640625, -7645.728515625, -6779.5966796875, -202.0673828125, -18601.2109375, 5505.0439453125, 17107.994140625, 14200.76953125, 3903.301025390625, 9999.9951171875, -4237.02392578125, 1316.4927978515625, 6421.00146484375, 2606.84912109375, -4413.908203125, -11088.5908203125]) )
#

def floatify(ip):
	flag = [float(ord(i)) for i in ip]
	normalized = torch.tensor([flag], dtype=torch.float32)
	return normalized

def tf(_in,_out):
	weight = np.round(np.random.uniform(-1, 1, (_out, _in)).astype(np.float32),2)
	bias = np.round(np.random.uniform(-1, 1, _out).astype(np.float32),2)
	return torch.from_numpy(weight), torch.from_numpy(bias)

np.random.seed(0x544350)
model = torch.nn.Sequential(
	torch.nn.Linear(24, 450),
	torch.nn.Linear(450, 128),
	torch.nn.Linear(128, 17)
)

layer_shapes = [(24, 450), (450, 128), (128, 17)]

for i, (input_dim, output_dim) in enumerate(layer_shapes):
	weight, bias = tf(input_dim, output_dim)
	model[i].weight.data = weight
	model[i].bias.data = bias


out = np.array(
	#[29709.939453125, 13703.603515625, -12409.185546875, 5280.5703125, -30940.85546875, -28987.638671875, 1030.4742431640625, 15358.9189453125, 7602.31787109375, -1503.1883544921875, 13749.7236328125, -4739.84375, 6073.92578125, 31966.41796875, -7056.52880859375, -14901.212890625, -20251.392578125]
	[30119.802734375, 13779.0263671875, -12472.4462890625, 5415.44580078125, -31216.16796875, -28912.287109375, 956.1978759765625, 15010.453125, 7361.8486328125, -1424.9993896484375, 13769.30078125, -4631.6044921875, 6077.791015625, 32217.505859375, -7041.21044921875, -14829.01953125, -20104.30859375]
	#[38883.9140625, 18747.87890625, -15371.05078125, 12231.2080078125, -56379.48046875, -33719.13671875, 9454.150390625, 9346.9814453125, 1701.4693603515625, -6380.3759765625, 12019.501953125, -4850.94140625, 14421.296875, 44332.0390625, -11196.283203125, -19712.0859375, -36390.265625]
)
#for i in range(2, -1, -1):
#	inv = np.linalg.pinv(model[i].weight.data.numpy())
#	b1 = np.dot(inv, out)
#	b2 = a[i] 
#	b3 = np.dot(inv, model[i].bias.data.numpy())
#	b = b1 -  b2 - b3
#	out = b

M3 = model[2].weight.data.numpy()
M2 = model[1].weight.data.numpy()
M1 = model[0].weight.data.numpy()
M = np.dot(M3, np.dot(M2, M1))
print(M.tolist())
M_inv = np.linalg.pinv(M)
b = np.dot(M_inv, out - a[3])
print(b)


sol = b + a[0]
flag = bytes( [ int(i) for i in sol.tolist() ])
print(flag)
#for i in range(2, -1, -1):
#	print(f"step {i}")
#	A = out - model[i].bias.data.numpy()
#	B = np.linalg.pinv(model[i].weight.data.numpy())
#	out = np.dot(B, A)

	#print(out)
	